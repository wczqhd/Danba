<template name="txt">
  <text class="msg-text" style="float:left;">{{ item.data }}</text>
</template>
<!--<template name="emoji">
  <image
     class="avatar"
     src="{{ '../../../images/faces/' + item.data }}"
     style="width:25px; height:25px; margin:0 0 2px 0; float:left;" />
</template>-->
<template name="img">
  <image
     class="avatar"
     src="{{ item.msg.data }}"
     style="width:90px; height:120px; margin:2px auto;"
     mode="aspectFit"
     bind:tap="previewImage"
     data-url="{{ item.msg.data }}" />
</template>
<template name="video">
  <video src="{{ item.msg.data }}" controls="" autoplay="" />
</template>
<template name="audio">
  <audio src="{{ item.msg.url }}" controls="" autoplay="" />
</template>


<!-- view 换成 scroll-view效果更好 用view是为了要stopPullDownRefresh -->
<view
	scroll-y="true"
	class="{{ view }} wrap {{isIPX?'scroll_view_X': ''}}"
	bind:tap="onTap"
	bindscroll="scrollmore"
	bindscrolltoupper="refresh"
	upper-threshold='-50'
	scroll-into-view="{{ toView }}">
  <view class="message" wx:for="{{ chatMsg }}" wx:key="index" id="{{ item.mid }}">

    <view class="main" class="{{ item.style }}"  wx:if="{{ item.msg.type != 'audio'  }}">
      <view class="user">
        <!-- yourname：就是消息的 from -->
        <text class="user-text">{{ item.yourname + ' ' + item.time}}</text>
      </view>
      <image class="avatar"    src="{{item.avatarUrl}}"/>
      <view class="msg"  >
        <image
        class="err {{(item.style == 'self' && item.isFail) ? 'show' : 'hide'}}"
        src="../../../images/msgerr.png"/>

       <!-- <image wx:if="{{item.style == 'self'}}" src="../../../images/poprightarrow@2x.png" class="msg_poprightarrow"/>-->
        <image wx:if="{{item.style == ''}}" src="../../../images/popleftarrow@2x.png" class="msg_popleftarrow"/>
        <view wx:if="{{ item.msg.type == 'img' || item.msg.type == 'video' }}">
          <!--<template is="{{ item.msg.type }}" data="{{ item }}"/>-->
          <view class="main">
            <image src="{{ item.msg.data }}"  bind:tap="previewImage"
		        data-url="{{ item.msg.data }}" class="radius" mode="widthFix"></image>
          </view>


        </view>

        <!--<audio-msg
           wx:if="{{ item.msg.type == 'audio' }}"
           msg="{{ item }}"></audio-msg>-->
        <view wx:elif="{{ item.msg.type == 'txt' || item.msg.type == 'emoji' }}" data-msg="{{item}}" bindtap="clickMsg">
          <view class="template" wx:for="{{ item.msg.data }}" wx:key="item">
            <template is="{{ item.type }}" data="{{ item }}"/>
          </view>
        </view>
      </view>





    </view>
    <view class="main" class="{{ item.style }}"  wx:if="{{ item.msg.type == 'audio'  }}">
      <view class="cu-card case {{isCard?'no-card':''}}">
        <view class="cu-item shadow">
          <view class="image">
            <image src="{{groupImage}}"  wx:if="{{groupImage != '11'}}"   mode="widthFix"></image>
            <!--<view class="cu-tag bg-green">史诗</view>-->
            <view class="cu-bar bg-shadeBottom">
              <text class="text-cut">{{Describe}}</text>
            </view>
          </view>
          <view class="cu-list menu-avatar">
            <view class="cu-item">
              <view class="cu-avatar round lg" style="background-image:url({{item.avatarUrl}});"></view>
              <view class="content flex-sub">
                <view class="text-grey">{{item.yourname}}</view>
                <view class="text-gray text-sm flex justify-between">
                  {{item.time}}
                  <view class="text-gray text-sm">

                    <text class="cuIcon-notificationfill margin-lr-xs"></text> 播放{{item.listencount}}次

                  </view>
                </view>
              </view>
            </view>
          </view>
          <view class="bg-green round padding flex flex-direction"  catchtap="togglePlayAudio"  data-data="{{item}}">

            <audio-msg
                             wx:if="{{ item.msg.type == 'audio' }}"
                             msg="{{ item }}"></audio-msg>

          </view>
          <view class="flex solid-bottom padding justify-center">
            <view class=" padding-sm margin-xs radius">
              <button class="cu-btn block round  {{item.like == 'yes'? bg-green:line-green}}   margin-tb-sm lg" catchtap="clickLike" data-data="{{item}}">
                <text class="cuIcon-appreciatefill">{{item.likecount}}</text>
              </button>
            </view>
            <view class=" padding-sm margin-xs radius">
              <button class="cu-btn block round bg-green margin-tb-sm lg" catchtap="clickShare" open-type= "share" data-data="{{item}}">
                <text class="cuIcon-share">分享{{item.sharecount}}</text>
              </button>
            </view>
          </view>

        </view>

      </view>


    </view>
  </view>
</view>
<view style="height: 1px;"></view>
